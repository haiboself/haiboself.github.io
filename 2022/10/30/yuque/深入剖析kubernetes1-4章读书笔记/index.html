<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>深入剖析kubernetes 1-4章阅读总结 | Hexo</title>
  <meta name="description" content="容器的来龙去脉PaaSPaas 解决的是应用程序的托管、打包与分发问题，强调零停机时间部署、自动规模伸缩与负载均衡等功能。用户可以在云服务商租一批虚拟机，然后可以用脚本或手动的方式在上面部署应用。以 Cloud Foundry 这个 PaaS 项目为例，它的核心组件就是一套应用的打包和分发机制。  用户把应用、启动脚本等打包到一个压缩包中，上传后 Cloud Foundry 会通过调度器选择一个合">
<meta property="og:type" content="article">
<meta property="og:title" content="深入剖析kubernetes 1-4章阅读总结">
<meta property="og:url" content="http://example.com/2022/10/30/yuque/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90kubernetes1-4%E7%AB%A0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="容器的来龙去脉PaaSPaas 解决的是应用程序的托管、打包与分发问题，强调零停机时间部署、自动规模伸缩与负载均衡等功能。用户可以在云服务商租一批虚拟机，然后可以用脚本或手动的方式在上面部署应用。以 Cloud Foundry 这个 PaaS 项目为例，它的核心组件就是一套应用的打包和分发机制。  用户把应用、启动脚本等打包到一个压缩包中，上传后 Cloud Foundry 会通过调度器选择一个合">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FuPjLKiFVYa-DwRncFIWBNWGuK5j.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FqlusSGRmjftiBMkQ_w3xUtbYSZ5.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Fml0oIoNRcC085M7LJ_vSbfUalz-.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FndkxBS64up84mNDriLbusNE5F1-.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FqqGf1h_NkB7e4uMpFL4ZXifYGaC.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Fr0JDa5yTx_7CWJCw6P8QCuJv42x.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FqIBHO5lcO-mwGGk6xle1tgFLQ7W.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FmpK9vucAm0UthqFNZ-9di1QrAWN.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FmRJsf10zALtbAr2spjzOWB8tPN8.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FnIJGJLeGcQ2TEom2KlEMqtXKcR9.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FquXMCuGlH5_c1UxS7y3yYNRFBtE.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FqT-l2WFN3E5cXPtT6BLWL5eaxtH.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Ftx9_KrvSZ903pTOCaCN3mQaiDpF.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Fk3BkRiAtTFhsYqOjba4-iBcv9f-.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FvLPmqKa4O6wE8DCJEgAS7Rin2xh.png">
<meta property="og:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Fr6IFeckIz1Ca5wmq17hLeSDqEUU.png">
<meta property="article:published_time" content="2022-10-30T06:41:51.000Z">
<meta property="article:modified_time" content="2022-11-25T07:31:23.221Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="容器">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FuPjLKiFVYa-DwRncFIWBNWGuK5j.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://example.com/2022/10/30/yuque/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90kubernetes1-4%E7%AB%A0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitment@0.0.3/style/default.min.css">
  
  
  
<meta name="generator" content="Hexo 6.3.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/haiboself" target="_blank">
          <img class="img-circle img-rotate" src="/images/curry.png" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">海博</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Fluent &amp; Low Latency</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Beijing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流分享~</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span class="category-list-count">9</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ddia/" rel="tag">ddia</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%B9%E5%99%A8/" rel="tag">容器</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/ddia/" style="font-size: 14px;">ddia</a> <a href="/tags/docker/" style="font-size: 13px;">docker</a> <a href="/tags/k8s/" style="font-size: 13px;">k8s</a> <a href="/tags/%E5%AE%B9%E5%99%A8/" style="font-size: 13px;">容器</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a>
              </p>
              <p class="item-title">
                <a href="/2022/10/30/yuque/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90kubernetes1-4%E7%AB%A0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" class="title">深入剖析kubernetes 1-4章阅读总结</a>
              </p>
              <p class="item-date">
                <time datetime="2022-10-30T06:41:51.000Z" itemprop="datePublished">2022-10-30</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>
              </p>
              <p class="item-title">
                <a href="/2019/12/12/Part-2-CHAPTER-9-Consistency-and-Consensus/" class="title">Part 2: CHAPTER 9 Consistency and Consensus</a>
              </p>
              <p class="item-date">
                <time datetime="2019-12-12T06:35:04.000Z" itemprop="datePublished">2019-12-12</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>
              </p>
              <p class="item-title">
                <a href="/2019/11/26/Part-2-CHAPTER-8-The-Trouble-with-Distributed-Systems/" class="title">Part 2: CHAPTER 8 The Trouble with Distributed Systems</a>
              </p>
              <p class="item-date">
                <time datetime="2019-11-26T06:33:34.000Z" itemprop="datePublished">2019-11-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>
              </p>
              <p class="item-title">
                <a href="/2019/11/17/Part-2-CHAPTER-7-Transactions/" class="title">Part 2: CHAPTER 7 Transactions</a>
              </p>
              <p class="item-date">
                <time datetime="2019-11-17T06:32:47.000Z" itemprop="datePublished">2019-11-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>
              </p>
              <p class="item-title">
                <a href="/2019/10/27/Part-2-CHAPTER-6-Partitioning/" class="title">Part 2: CHAPTER 6 Partitioning</a>
              </p>
              <p class="item-date">
                <time datetime="2019-10-27T06:28:55.000Z" itemprop="datePublished">2019-10-27</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%9A%84%E6%9D%A5%E9%BE%99%E5%8E%BB%E8%84%89"><span class="toc-number">1.</span> <span class="toc-text">容器的来龙去脉</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PaaS"><span class="toc-number">1.1.</span> <span class="toc-text">PaaS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker"><span class="toc-number">1.2.</span> <span class="toc-text">Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#K8s"><span class="toc-number">1.3.</span> <span class="toc-text">K8s</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">容器技术基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Namespace-3"><span class="toc-number">2.1.</span> <span class="toc-text">Namespace[3]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cgroups"><span class="toc-number">2.2.</span> <span class="toc-text">Cgroups</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rootfs-13"><span class="toc-number">2.3.</span> <span class="toc-text">Rootfs[13]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#K8s-%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.</span> <span class="toc-text">K8s 的设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E8%83%BD%E5%8A%9B%E4%B8%8E%E5%AE%9A%E4%BD%8D"><span class="toc-number">3.1.</span> <span class="toc-text">核心能力与定位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1-11"><span class="toc-number">3.2.</span> <span class="toc-text">架构设计[11]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod-12"><span class="toc-number">3.3.</span> <span class="toc-text">Pod[12]</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">引用</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-yuque/深入剖析kubernetes1-4章读书笔记" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      深入剖析kubernetes 1-4章阅读总结
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2022/10/30/yuque/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90kubernetes1-4%E7%AB%A0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" class="article-date">
	  <time datetime="2022-10-30T06:41:51.000Z" itemprop="datePublished">2022-10-30</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/docker/" rel="tag">docker</a>, <a class="article-tag-link-link" href="/tags/k8s/" rel="tag">k8s</a>, <a class="article-tag-link-link" href="/tags/%E5%AE%B9%E5%99%A8/" rel="tag">容器</a>
  </span>


        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/10/30/yuque/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90kubernetes1-4%E7%AB%A0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="容器的来龙去脉"><a href="#容器的来龙去脉" class="headerlink" title="容器的来龙去脉"></a>容器的来龙去脉</h1><h2 id="PaaS"><a href="#PaaS" class="headerlink" title="PaaS"></a>PaaS</h2><p>Paas 解决的是应用程序的<strong>托管</strong>、<strong>打包</strong>与<strong>分发</strong>问题，强调零停机时间部署、自动规模伸缩与负载均衡等功能。用户可以在云服务商租一批虚拟机，然后可以用脚本或手动的方式在上面部署应用。<br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FuPjLKiFVYa-DwRncFIWBNWGuK5j.png"><br>以 Cloud Foundry 这个 PaaS 项目为例，它的<strong>核心组件就是一套应用的打包和分发机制。</strong></p>
<ul>
<li>用户把应用、启动脚本等打包到一个压缩包中，上传后 Cloud Foundry 会通过调度器选择一个合适的虚拟机，然后通知这个机器的 Agent 下载应用压缩包并启动</li>
<li>由于需要在一个虚拟机上启动多个应用，Cloud Foundry 会调用操作系统的 Cgroups 和 Namespace 机制为每个应用单独创建一个隔离环境唤做<strong>“沙盒”</strong>，然后在里面启动应用进程。</li>
</ul>
<p><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FqlusSGRmjftiBMkQ_w3xUtbYSZ5.png"><br>这样就把多个应用在虚拟机中互不干扰的自动运行了起来，<strong>这些“隔离环境”，就是“容器”，</strong>后文具体介绍。</p>
<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>Docker 容器和 Cloud Foundry “沙箱”没有本质区别，它主要解决了 PaaS 中“应用打包难”的问题。<br>Docker 之前应用打包难：</p>
<ul>
<li>用户必须为每种语言、每种框架，甚至每个版本为一个一个打好的包。</li>
<li>打包过程没有章法可循，且在本地良好运行的应用，需要做很多配置和修改才能在 Paas 中运行。</li>
</ul>
<p>Docker 的解决方案:</p>
<ul>
<li>镜像，就是打包了应用程序 + 需要的<strong>整个操作系统</strong>，从而保证了本地环境和云端环境的<strong>高度一致</strong>，<strong>避免</strong>了用户通过“试错”来匹配不同运行环境之间差异的过程。</li>
</ul>
<p>Docker 只是解决了打包部分的问题，但是<strong>并不负责“分发”、“应用部署”。</strong><br>因此，Docker 提供了 Swarm 工具来做集群管理，swarm 集群由管理节点（manager）和工作节点（work node）构成。</p>
<ul>
<li><strong>swarm mananger</strong>：负责整个集群的管理工作包括集群配置、服务管理等所有跟集群有关的工作。</li>
<li><strong>work node</strong>：即图中的 available node，主要负责运行相应的服务来执行任务（task）。</li>
</ul>
<p><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Fml0oIoNRcC085M7LJ_vSbfUalz-.png"></p>
<p>Compose（Fig）项目来做容器编排。</p>
<ul>
<li>容器编排：指用户通过某些工具或配置来完成一组虚拟机以及关联资源的定义、配置、创建、删除等工作。</li>
<li>对 docker 而言，编排就是对 docker <strong>容器的一系列定义、配置和创建动作的管理</strong>。比如定义多个容器之间的<strong>依赖关系</strong>[2]</li>
</ul>
<p><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FndkxBS64up84mNDriLbusNE5F1-.png"></p>
<h2 id="K8s"><a href="#K8s" class="headerlink" title="K8s"></a>K8s</h2><p>“容器的价值非常有限，真正有价值的是<strong>容器编排</strong>”，很多项目（Yarn，Mesos，Docker Swarm）擅长的是把一个容器按照某种规则放置到某个最佳节点上执行，这种功能成为“调度”。K8s 擅长的是<strong>编排</strong>，即按照用户的意愿和整个系统的规则，<strong>完全自动化地处理好容器之间的各种关系。</strong><br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FqqGf1h_NkB7e4uMpFL4ZXifYGaC.png"><br>[14]</p>
<h1 id="容器技术基础"><a href="#容器技术基础" class="headerlink" title="容器技术基础"></a>容器技术基础</h1><p>容器技术的核心功能，就是通过约束和修改进程的“动态表现”，为其创造一个“边界”。以 Linux 容器为例</p>
<ol>
<li>NameSpace 技术是用来进行<strong>隔离</strong>资源的主要方法。</li>
<li>Cgroups 技术是用来<strong>限制</strong>（限制 cpu、内存、存储等资源）的主要手段</li>
</ol>
<h2 id="Namespace-3"><a href="#Namespace-3" class="headerlink" title="Namespace[3]"></a>Namespace[3]</h2><p>Linux Namespace 提供了一种内核级别隔离系统资源的方法，通过将系统的全局资源放在不同的 Namespace 中，来实现资源隔离的目的。 目前提供了 6 种系统资源的隔离机制</p>
<ul>
<li>Mount：隔离文件系统</li>
<li>UTS：隔离主机名和域名信息</li>
<li>IOC：隔离进程间通信</li>
<li>PID：隔离进程的 ID</li>
<li>Network：隔离网络资源</li>
<li>User：隔离用户和用户组的 ID</li>
</ul>
<p>以 PID 隔离[7]为例，举个例子：<br>1）在宿主机启动一个 docker 容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it busybox /bin/sh</span><br></pre></td></tr></table></figure>

<p>2）查看进程号<br>左边是容器(隔离出的空间)的中的进程号为 1，对应到右边宿主机中真实的进程好为 30789<br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Fr0JDa5yTx_7CWJCw6P8QCuJv42x.png"><br>3）实际上，docker 利用 Namespace 机制，施了一个障眼法，对被隔离的进程空间动了手脚，使得这些进程看到的是“重新计算过的 PID”<br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FqIBHO5lcO-mwGGk6xle1tgFLQ7W.png"></p>
<p>实际上，在创建进程时候传递对应的 NameSpace 参数，来对进程上下文施展各种障眼法，这样进程就只能看到所属 NameSpace 下的资源信息。容器就使用了这种技术，Docker 启动的还是原来的应用进程，只不过在创建这些进程时，Docker 为他们加上了各种各样的 Namespace 参数。所以：<strong>容器其实只是一种特殊的进程，用户应用实际上就是容器中 PID&#x3D;1 的进程。</strong><br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FmpK9vucAm0UthqFNZ-9di1QrAWN.png"></p>
<h2 id="Cgroups"><a href="#Cgroups" class="headerlink" title="Cgroups"></a>Cgroups</h2><p>Linux Cggroups(Linux control groups) 最主要的作用就是限制一个进程组能够使用的资源上限，包括 CPU、内存、磁盘、网络带宽等等。cgroup 通过以下组件来抽象进程和资源[9]</p>
<ul>
<li>task：任务，对应进程</li>
<li>subsystem：子系统，具体的资源控制器，控制某个特定的资源使用，如 cpu 子系统控制 cpu 使用时间</li>
<li>cgroup：控制组，一组任务和子系统的关联关系，标识对这些任务进行怎样的资源控制策略</li>
<li>hierarchy：层级树，一些列 cgroup 组成的树形结构。</li>
</ul>
<p>进程和 cgroup 是多对多的关系[10]：<br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FmRJsf10zALtbAr2spjzOWB8tPN8.png"></p>
<p>Cgroup 使用示例：<br>1）Linux 下 cgroups 以文件和目录方式组织在 &#x2F;sys&#x2F;fs&#x2F;cgroup 下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-16-5-centos ~]<span class="comment"># mount -t cgroup</span></span><br><span class="line">cgroup on /sys/fs/cgroup/systemd <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)</span><br><span class="line">cgroup on /sys/fs/cgroup/perf_event <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)</span><br><span class="line">cgroup on /sys/fs/cgroup/blkio <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,blkio)</span><br><span class="line">cgroup on /sys/fs/cgroup/net_cls,net_prio <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio)</span><br><span class="line">cgroup on /sys/fs/cgroup/devices <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,devices)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpuset <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)</span><br><span class="line">cgroup on /sys/fs/cgroup/memory <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,memory)</span><br><span class="line">cgroup on /sys/fs/cgroup/freezer <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,freezer)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpu,cpuacct <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,cpu,cpuacct)</span><br><span class="line">cgroup on /sys/fs/cgroup/pids <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,pids)</span><br><span class="line">cgroup on /sys/fs/cgroup/hugetlb <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)</span><br><span class="line">cgroup on /sys/fs/cgroup/rdma <span class="built_in">type</span> cgroup (rw,nosuid,nodev,noexec,relatime,rdma)</span><br></pre></td></tr></table></figure>

<p>2）以 cpu 使用限制为例，在 cpu 下创建 container 目录（控制组）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-16-5-centos container]<span class="comment"># ls</span></span><br><span class="line">cgroup.clone_children  cpuacct.stat   cpuacct.usage_all     cpuacct.usage_percpu_sys   cpuacct.usage_sys   cpu.cfs_period_us  cpu.shares  notify_on_release</span><br><span class="line">cgroup.procs           cpuacct.usage  cpuacct.usage_percpu  cpuacct.usage_percpu_user  cpuacct.usage_user  cpu.cfs_quota_us   cpu.stat    tasks</span><br></pre></td></tr></table></figure>

<p>3）限制 cpu 的使用，表示在 100ms 的时间内，被该控制组限制的进程只能使用 20ms 的 cpu 时间，可以将需要限制的进程 id 写入到 tasks 文件中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 100000 &gt; /sys/fs/cgroup/cpu/container/cpu.cfs_period_us</span><br><span class="line"><span class="built_in">echo</span> 20000 &gt; /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us</span><br><span class="line"><span class="built_in">echo</span> $(pid) &gt; /sys/fs/cgroup/cpu/container/tasks</span><br></pre></td></tr></table></figure>

<p>Docker 创建 linux 容器时，只需要在每个子系统下创建对应的控制组（新建目录），然后在启动容器进程后，把整个进程的 PID 天蝎到对应控制组的 tasks 文件中就可以完成资源的限制。如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-16-5-centos container]docker run -it --cpu-period=100000 --cpu-quota=20000 busybox /bin/sh</span><br><span class="line">[root@VM-16-5-centos docker-4cd72e800ed85e9502818dfc1bec238f653da27e10ce61f74d50fb501f819200.scope]<span class="comment"># ls</span></span><br><span class="line">cgroup.clone_children  cpuacct.usage_all          cpuacct.usage_sys   cpu.shares</span><br><span class="line">cgroup.procs           cpuacct.usage_percpu       cpuacct.usage_user  cpu.stat</span><br><span class="line">cpuacct.stat           cpuacct.usage_percpu_sys   cpu.cfs_period_us   notify_on_release</span><br><span class="line">cpuacct.usage          cpuacct.usage_percpu_user  cpu.cfs_quota_us    tasks</span><br><span class="line">[root@VM-16-5-centos docker-4cd72e800ed85e9502818dfc1bec238f653da27e10ce61f74d50fb501f819200.scope]<span class="comment"># cat cpu.cfs_quota_us</span></span><br><span class="line">20000</span><br><span class="line">[root@VM-16-5-centos docker-4cd72e800ed85e9502818dfc1bec238f653da27e10ce61f74d50fb501f819200.scope]<span class="comment"># cat cpu.cfs_period_us</span></span><br><span class="line">100000</span><br><span class="line">[root@VM-16-5-centos docker-4cd72e800ed85e9502818dfc1bec238f653da27e10ce61f74d50fb501f819200.scope]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="Rootfs-13"><a href="#Rootfs-13" class="headerlink" title="Rootfs[13]"></a>Rootfs[13]</h2><p>容器进程应该“看到”，一个完全隔离、独立的文件环境，而不是继承自宿主机的文件系统。在 Linux 中要实现这一点，要借助 chroot(change root file system) 命令，可以将指定目录挂载为指定容器进程的根目录。<br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FnIJGJLeGcQ2TEom2KlEMqtXKcR9.png"><br>一般会在容器的根目录下“挂在一个完整的操作系统的文件系统目录”，这个用来为容器进程提供隔离后执行环境的文件系统，就是“容器镜像”，即 rootrs（根文件系统）；</p>
<ul>
<li>这些文件不包含操作系统内核，所以区别于虚拟机同一台机器上所有容器都是共享操作系统内核的。</li>
</ul>
<p>（容器和虚拟机的对比）<br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FquXMCuGlH5_c1UxS7y3yYNRFBtE.png"></p>
<ul>
<li>打包操作系统文件目录，赋予了容器的一致性：无论在本地、云端或其他机器上，只需解压打包好的镜像，这个应用运行所需要的完整的执行环境就能重现。</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>容器实际是由 Linux Namespace，Linux Cgroup 和 Rootfs 3 种技术构建出来的进程的隔离环境，一个运行的 Linux 容器，可以被一分为二的看待：</p>
<ol>
<li>容器镜像：一组联合挂载在 &#x2F;var&#x2F;lib&#x2F;docker&#x2F;aufs&#x2F;mnt 上的 rootfs，是容器的静态视图</li>
<li>容器运行时：一个由 Namespace + Cgroups 构成的隔离环境，是容器的动态视图</li>
</ol>
<h1 id="K8s-的设计"><a href="#K8s-的设计" class="headerlink" title="K8s 的设计"></a>K8s 的设计</h1><h2 id="核心能力与定位"><a href="#核心能力与定位" class="headerlink" title="核心能力与定位"></a>核心能力与定位</h2><p>在大规模集群中的各种任务之间运行，实际存在各种各样的关系。<strong>这些关系的处理才是作业编排和管理系统最困难的地方。K8s 的核心能力就是要解决这个问题，而不是拉取和部署镜像。</strong><br>K8s 的主要设计思路是：</p>
<ul>
<li>以统一的方式抽象底层基础设施能力（计算、存储、网络等）；定义任务编排的各种关系（如亲密关系、访问关系、代理关系）</li>
<li>以声明式 api（yaml）的方式对外暴露，从而允许用户基于这些抽象构建自己的上层 平台（如自己的 paas）</li>
<li>所以，K8s 的本质是 “平台的平台”，一个帮助用户构建上层平台的基础平台。</li>
</ul>
<p>如图，K8s 是如何定义任务编排的各种关系的</p>
<ul>
<li>Pod 中的容器共享同一个 Network Namespace、同组 Volume，从而实现高效交换信息。</li>
</ul>
<p><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FqT-l2WFN3E5cXPtT6BLWL5eaxtH.png"></p>
<h2 id="架构设计-11"><a href="#架构设计-11" class="headerlink" title="架构设计[11]"></a>架构设计[11]</h2><p>分为 Master 控制节点和 Node 计算节点</p>
<ul>
<li>Master：Controller Manager 负责容器编排；整个集群的数据，由 Api Server 处理后存储在 etcd 中</li>
<li>Node：<ul>
<li>kubelet 主要负责和容器运行时（如 Docker）交互，交互依赖 CRI(container runtime interface)远程调用接口。如 Docker 通过 OCI 容器运行时规范同 Linux 交互，把 CRI 请求翻译为对 Linux 系统的调用（操作 Namespace，Cgroups 等）</li>
<li>Device Plugin：是 k8s 用来管理 GPU 等宿主机无力设备的主要组件，kubelet 通过 grpc 和其交互</li>
<li>CNI(container networking interface)：kubelet 调用其为容器配置网络</li>
<li>CSI(container storage interface)：kubelet 调用其为容器配置持久化存储</li>
</ul>
</li>
</ul>
<p><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Ftx9_KrvSZ903pTOCaCN3mQaiDpF.png"></p>
<h2 id="Pod-12"><a href="#Pod-12" class="headerlink" title="Pod[12]"></a>Pod[12]</h2><p>容器是一个单进程模型，容器不具备进程管理能力，所以一个容器中只包含一个应用进程是合理的；当几个应用（容器）之间具有协作关系，需要共享某些资源，必须放在一起去管理（如必须运行在同一台机器上）要怎么办，而 pod 就是 k8s 给出的解决方案。<br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Fk3BkRiAtTFhsYqOjba4-iBcv9f-.png"></p>
<p>Pod 实际上是个逻辑概念，无力上对应的是一组容器；除此之外，Pod 是 Kubernetes 分配资源的一个单位，因为里面的容器要共享某些资源，所以 Pod 也是 Kubernetes 的原子调度单位。</p>
<h1 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h1><p>PaaS 解决应用：打包、分发部署、托管执行方面的问题</p>
<ul>
<li>打包：缺乏标准，打包难问题 -&gt; docker 容器镜像（增量 rootfs、layer）解决了这个问题，成为事实上的打包标准；</li>
<li>执行：依赖 linux os 自身的 namespace、cgroups、chroot 实现的容器技术解决这方面的问题；<ul>
<li>namespace：隔离进程资源视图</li>
<li>cgroups：限制进程的资源使用</li>
</ul>
</li>
</ul>
<p>PaaS 的 3 个问题解决好后，K8s 解决更上层的问题：容器、应用编排。从而成为平台的平台；如 cloud foundry 和 k8s 的结合[15]：<br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/FvLPmqKa4O6wE8DCJEgAS7Rin2xh.png"><br><img src="https://blog-1314398479.cos.ap-nanjing.myqcloud.com/undefined/Fr6IFeckIz1Ca5wmq17hLeSDqEUU.png"></p>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.spiceworks.com/tech/cloud/articles/what-is-platform-as-a-service/">https://www.spiceworks.com/tech/cloud/articles/what-is-platform-as-a-service/</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@krishnakummar/creating-block-diagrams-from-your-docker-compose-yml-da9d5a2450b4">https:&#x2F;&#x2F;medium.com&#x2F;@krishnakummar&#x2F;creating-block-diagrams-from-your-docker-compose-yml-da9d5a2450b4</a></li>
<li><a target="_blank" rel="noopener" href="https://techtutorialsite.com/docker-vs-virtual-machines/">https://techtutorialsite.com/docker-vs-virtual-machines/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.slideshare.net/AdamFitzGerald/cf-overview-gitpro">https://www.slideshare.net/AdamFitzGerald/cf-overview-gitpro</a></li>
<li><a target="_blank" rel="noopener" href="https://www.slideshare.net/jaxLondonConference/run-your-java-apps-on-cloud-foundry-andy-piper-pivotal">https://www.slideshare.net/jaxLondonConference/run-your-java-apps-on-cloud-foundry-andy-piper-pivotal</a></li>
<li><a target="_blank" rel="noopener" href="https://blogs.sap.com/2018/06/05/cloud-native-with-containers-and-kubernetes-part-2/">https://blogs.sap.com/2018/06/05/cloud-native-with-containers-and-kubernetes-part-2/</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/73248894">https://zhuanlan.zhihu.com/p/73248894</a></li>
<li><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/what-are-namespaces-cgroups-how-do-they-work/">https://www.nginx.com/blog/what-are-namespaces-cgroups-how-do-they-work/</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6921299245685276686">https://juejin.cn/post/6921299245685276686</a></li>
<li><a target="_blank" rel="noopener" href="https://tech.meituan.com/2015/03/31/cgroups.html">https://tech.meituan.com/2015/03/31/cgroups.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/luoahong/p/12330735.html">https://www.cnblogs.com/luoahong/p/12330735.html</a></li>
<li><a target="_blank" rel="noopener" href="http://dockone.io/article/9290">http://dockone.io/article/9290</a></li>
<li><a target="_blank" rel="noopener" href="https://www.feiyiblog.com/2020/03/27/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84%E7%90%86%E8%AE%BA%E8%AF%A6%E8%A7%A31/">https://www.feiyiblog.com/2020/03/27/%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84%E7%90%86%E8%AE%BA%E8%AF%A6%E8%A7%A31/</a></li>
<li><a target="_blank" rel="noopener" href="https://blogs.sap.com/2018/10/19/cloud-foundry-and-kubernetes-where-do-they-differ-how-do-they-fit-together/">https://blogs.sap.com/2018/10/19/cloud-foundry-and-kubernetes-where-do-they-differ-how-do-they-fit-together/</a></li>
<li><a target="_blank" rel="noopener" href="https://blogs.sap.com/2021/01/15/back-to-the-future-cloud-foundry-on-kubernetes/">https://blogs.sap.com/2021/01/15/back-to-the-future-cloud-foundry-on-kubernetes/</a></li>
</ol>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://example.com/2022/10/30/yuque/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90kubernetes1-4%E7%AB%A0%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" title="深入剖析kubernetes 1-4章阅读总结" target="_blank" rel="external">http://example.com/2022/10/30/yuque/深入剖析kubernetes1-4章读书笔记/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/haiboself" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/curry.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/haiboself" target="_blank"><span class="text-dark">海博</span><small class="ml-1x">Fluent &amp; Low Latency</small></a></h3>
        <div>大数据基础架构工程师</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	

    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    
    <li class="next">
      <a href="/2019/12/12/Part-2-CHAPTER-9-Consistency-and-Consensus/" title="Part 2: CHAPTER 9 Consistency and Consensus"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">    <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>感谢您的支持，我会继续努力的!</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
<script src="//cdn.jsdelivr.net/npm/gitment@0.0.3/dist/gitment.browser.min.js"></script>
<script>
var gitment = new Gitment({
  // id默认为当前页面url，如果url后带参数或锚点，gitment要重新初始化
  // https://github.com/imsun/gitment/issues/55
  // 解决方案：id:window.location.pathname,或者将id设置为当前页面标题
  id: '深入剖析kubernetes 1-4章阅读总结', 
  owner: 'haiboself', // 可以是你的GitHub用户名，也可以是github id
  repo: 'haiboself.github.io',
  oauth: {
    client_id: '5bc7d4254095d8c34248',
    client_secret: 'c82c5c95205f7e6bdc7c9924fa0fdcda63f8411c',
  }
})
gitment.render('comments')
</script>









</body>
</html>